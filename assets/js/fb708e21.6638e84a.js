(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{83:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return o})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return c}));var a=n(3),r=n(7),i=(n(0),n(88)),l={title:"Retrieving A Field Map Of The Query"},o={unversionedId:"utilities/retrieve-field-map",id:"utilities/retrieve-field-map",isDocsHomePage:!1,title:"Retrieving A Field Map Of The Query",description:"Field Maps are one of the most essential pieces of GraphQL-Utils. They are a parsed version of the GraphQL AST simplified to take fragments into account as well as remove the extra data we aren't interested in.",source:"@site/docs/utilities/retrieve-field-map.md",slug:"/utilities/retrieve-field-map",permalink:"/graphql-utils/docs/utilities/retrieve-field-map",editUrl:"https://github.com/jenyus-org/graphql-utils/edit/master/docs/docs/utilities/retrieve-field-map.md",version:"current",sidebar:"docsSidebar",previous:{title:"Getting Started",permalink:"/graphql-utils/docs/getting-started"},next:{title:"Checking For Fields",permalink:"/graphql-utils/docs/utilities/checking-for-fields"}},s=[{value:"Resolving A Field Map",id:"resolving-a-field-map",children:[{value:"Deep",id:"deep",children:[]},{value:"Flat",id:"flat",children:[]},{value:"Under A Specified Parent",id:"under-a-specified-parent",children:[]}]}],p={toc:s};function c(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Field Maps")," are one of the most essential pieces of ",Object(i.b)("strong",{parentName:"p"},"GraphQL-Utils"),". They are a parsed version of the GraphQL AST simplified to take fragments into account as well as remove the extra data we aren't interested in."),Object(i.b)("p",null,"You can read more about the ",Object(i.b)("inlineCode",{parentName:"p"},"FieldMap")," interface ",Object(i.b)("a",{parentName:"p",href:"/graphql-utils/docs/reference/field-map"},"here"),"."),Object(i.b)("p",null,"In order to retrieve the field map we can use the ",Object(i.b)("inlineCode",{parentName:"p"},"resolveFieldMap()")," helper, which takes ",Object(i.b)("inlineCode",{parentName:"p"},"info")," as its only required argument, and we may additionally specify whether a deep field map should be parsed, so we can check nested data and calculate the cost of a query, or just a single layer for example to help us optimize our SQL ",Object(i.b)("inlineCode",{parentName:"p"},"SELECT")," and ",Object(i.b)("inlineCode",{parentName:"p"},"JOIN")," queries."),Object(i.b)("h2",{id:"resolving-a-field-map"},"Resolving A Field Map"),Object(i.b)("p",null,"In order to resolve a field map, all we need to do is use the ",Object(i.b)("inlineCode",{parentName:"p"},"info")," argument passed to our GraphQL resolvers, and retrieve the field map using the ",Object(i.b)("inlineCode",{parentName:"p"},"resolveFieldMap()")," helper, we can pass various options to adjust the output."),Object(i.b)("p",null,"Let's take a look at an example query:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-gql"},"{\n  posts {\n    id\n    title\n    body\n    author {\n      id\n      username\n      firstName\n      lastName\n    }\n  }\n}\n")),Object(i.b)("h3",{id:"deep"},"Deep"),Object(i.b)("p",null,"If we want the deep field map without any additional configuration, all we need to do is call ",Object(i.b)("inlineCode",{parentName:"p"},"resolveFieldMap()")," with our ",Object(i.b)("inlineCode",{parentName:"p"},"info")," object:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},'import { resolveFieldMap } from "@jenyus-org/graphql-utils";\n\nconst resolvers = {\n  Query: {\n    posts(_, __, ___, info) {\n      const fieldMap = resolveFieldMap(info);\n      console.log(fieldMap);\n    },\n  },\n};\n')),Object(i.b)("p",null,"This will output the following field map:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"{\n  posts: {\n    id: {},\n    title: {},\n    body: {},\n    author: {\n      id: {},\n      username: {},\n      firstName: {},\n      lastName: {},\n    },\n  }\n}\n")),Object(i.b)("p",null,"Now, if we want to know which columns to ",Object(i.b)("inlineCode",{parentName:"p"},"SELECT")," from our database, we can use a simple filter to only retrieve those fields without subselections, and then print those keys:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"const fields = Object.entries(fieldMap.posts)\n  .filter(([key, values]) => Object.keys(values).length)\n  .map(([key, _]) => key);\nconsole.log(fields);\n")),Object(i.b)("p",null,"Our output will be as follows:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},'["id", "title", "body"];\n')),Object(i.b)("h3",{id:"flat"},"Flat"),Object(i.b)("p",null,"We can also resolve a flat field map, if we only want to use it to e.g. optimize SQL queries. The flat field map will be able to tell us which columns we need to select, which can be used in combination with a query builder like KnexJS or ORMs like MikroORM to make more efficient calls to our database."),Object(i.b)("p",null,"For this we simply pass ",Object(i.b)("inlineCode",{parentName:"p"},"false")," to the second argument of ",Object(i.b)("inlineCode",{parentName:"p"},"resolveFieldMap()"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},'import { resolveFieldMap } from "@jenyus-org/graphql-utils";\n\nconst resolvers = {\n  Query: {\n    posts(_, __, ___, info) {\n      const fieldMap = resolveFieldMap(info, false);\n      console.log(fieldMap);\n    },\n  },\n};\n')),Object(i.b)("p",null,"This will output the following field map:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"{\n  posts: {\n    id: {},\n    title: {},\n    body: {},\n    author: {},\n  }\n}\n")),Object(i.b)("p",null,"Then, we could use ",Object(i.b)("inlineCode",{parentName:"p"},"Object.keys()")," to get a list of all the selected fields:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"const fields = Object.keys(fieldMap.posts);\nconsole.log(fields);\n")),Object(i.b)("p",null,"Our output will be as follows:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},'["id", "title", "body", "author"];\n')),Object(i.b)("p",null,"Since ",Object(i.b)("inlineCode",{parentName:"p"},"author")," isn't per se a field we can just ",Object(i.b)("inlineCode",{parentName:"p"},"SELECT")," from our database, it might make more sense to use the deep field map to filter out fields with subselections as we showed above."),Object(i.b)("h3",{id:"under-a-specified-parent"},"Under A Specified Parent"),Object(i.b)("p",null,"If we only want to retrieve the field map under a specified parent, we can use dot-notation or an array of strings to specify this parent. This can be useful for queries that are computed instead of direct entrypoints to database tables, and we need to get all the fields requested for each entity."),Object(i.b)("p",null,"Let's change up our query a bit:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-gql"},"{\n  postsOverview {\n    topPosts {\n      id\n      title\n      body\n      author {\n        id\n        username\n        firstName\n        lastName\n      }\n    }\n    risingPosts {\n      id\n      title\n      body\n      author {\n        id\n        username\n        firstName\n        lastName\n      }\n    }\n  }\n}\n")),Object(i.b)("p",null,"Now we can specify the parent under which we want to get our field map from with either of the two syntaxes:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},'"postsOverview.topPosts"')),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},'["postsOverview", "topPosts"]'))),Object(i.b)("p",null,"The rest of how ",Object(i.b)("inlineCode",{parentName:"p"},"resolveFieldMap()")," works is identical to the previous examples, we just need to make sure to specify ",Object(i.b)("inlineCode",{parentName:"p"},"deep")," in the arguments:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},'import { resolveFieldMap } from "@jenyus-org/graphql-utils";\n\nconst resolvers = {\n  Query: {\n    postsOverview(_, __, ___, info) {\n      const fieldMap = resolveFieldMap(info, true, "postsOverview.topPosts");\n      console.log(fieldMap);\n    },\n  },\n};\n')),Object(i.b)("p",null,"This will output the following field map:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"{\n  topPosts: {\n    id: {},\n    title: {},\n    body: {},\n    author: {\n      id: {},\n      username: {},\n      firstName: {},\n      lastName: {},\n    },\n  }\n}\n")))}c.isMDXComponent=!0},88:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return f}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=r.a.createContext({}),c=function(e){var t=r.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=c(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},b=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),b=a,f=d["".concat(l,".").concat(b)]||d[b]||u[b]||i;return n?r.a.createElement(f,o(o({ref:t},p),{},{components:n})):r.a.createElement(f,o({ref:t},p))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=b;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);